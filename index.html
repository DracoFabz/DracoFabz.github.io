<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deck Tester</title>
    <style>
        body {margin: 0; font-family: Arial, sans-serif; background-color: #f0f0f0; overflow: hidden;}
        #banner {background-color: #3466af; color: #dedede; text-align: left; padding: 1.5% 1.5%; font-size: 2.5vw; text-transform: uppercase; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;  position: fixed; width: 100%; top: 0; left: 0; z-index: 1; box-sizing: border-box;}
        #buttons-banner {background-color: #ffffff; text-align: left; padding: 1% 2%; position: fixed; width: 100%; top: calc(2% + 1.5% + 1em); left: 0; z-index: 1; box-sizing: border-box;}
        .button {background-color: #3466af; color: #dedede; border: none; border-radius: 20px; cursor: pointer; transition: background-color 0.3s; font-size: 0.7vw; display: inline-block; margin: 0 5px; box-sizing: border-box;}
        .button:hover, .button:active {background-color: #4976b7;}
        #drag-container {position: fixed; top: calc(2% + 1.5% + 1em + 3 * (3vw)); left: 5px; right: 5px; bottom: 5px; background: url('https://github.com/DracoFabz/DracoFabz.github.io/raw/main/Layout.png') no-repeat top left; background-size: cover; overflow: hidden; z-index: 0;}
        .card {position: absolute; cursor: pointer; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); z-index: 2; transition: transform 0.3s;}
        #popup {display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #ffffff; border: 2px solid grey; padding: 20px; border-radius: 20px; width: 300px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); z-index: 3;}
        #popup h2 {margin-top: 0;}
        #text-input {width: 100%; height: 100px; border: 1px solid grey; border-radius: 10px; margin: 10px 0; padding: 10px; resize: none;}
        #popup-buttons {text-align: center;}
    </style>
</head>
<body>
    <div id="banner">Deck Tester</div>
    <div id="buttons-banner">
        <button class="button" id="donate-button">Donate</button>
        <button class="button" id="import-button">Import Deck</button>
        <button class="button" id="clear-deck-button">Clear Deck</button>
    </div>
    <div id="drag-container">
    </div>
    <div id="popup">
        <h2>Importing Deck</h2>
        <p>Paste here the codes from Digimon.io</p>
        <textarea id="text-input"></textarea>
        <div id="popup-buttons">
            <button class="button" id="load-code-button">Load Code</button>
            <button class="button" id="go-back-button">Go Back</button>
        </div>
    </div>
<script>
    const donateButton = document.getElementById('donate-button');
    const importButton = document.getElementById('import-button');
    const popup = document.getElementById('popup');
    const goBackButton = document.getElementById('go-back-button');
    const loadCodeButton = document.getElementById('load-code-button');
    const clearDeckButton = document.getElementById('clear-deck-button');
    const container = document.getElementById('drag-container');
    const defaultImageUrl = 'https://images.digimoncard.io/images/assets/CardBack.jpg';
    donateButton.addEventListener('click', () => {
        alert('Thanks for donation');
    });
    importButton.addEventListener('click', () => {
        popup.style.display = 'block';
    });
    goBackButton.addEventListener('click', () => {
        popup.style.display = 'none';
    });
    loadCodeButton.addEventListener('click', () => {
        const input = document.getElementById('text-input').value.trim();
        const lines = input.split('\n');
        lines.forEach(line => {
            const [count, code] = line.trim().split(' ');
            const numCards = parseInt(count);
            const cardCode = code.toUpperCase().trim();
            if (!isNaN(numCards) && cardCode) {
                addCards(numCards, cardCode);
            }
        });
        popup.style.display = 'none';
    });
    clearDeckButton.addEventListener('click', () => {
        while (container.firstChild) {
            container.removeChild(container.firstChild);
        }
    });
    function addCards(num, code) {
        for (let i = 0; i < num; i++) {
            const card = document.createElement('img');
            const imageUrl = `https://images.digimoncard.io/images/cards/${code}.jpg`;
            const img = new Image();
            img.src = imageUrl;
            img.onload = function() {
                card.src = imageUrl;
                centerCard(card);};
            img.onerror = function() {
                card.src = defaultImageUrl;
                centerCard(card);};
            card.className = 'card';
            card.style.width = (window.innerWidth / 10) + 'px';
            card.style.height = 'auto';
            container.appendChild(card);
            makeDraggable(card);
        }
        popup.style.display = 'none';
    }
    function centerCard(card) {
        const containerWidth = container.offsetWidth;
        const containerHeight = container.offsetHeight;
        const cardWidth = card.offsetWidth;
        const cardHeight = card.offsetHeight;
        const defaultCenterXRatio = 0.875;
        const defaultCenterYRatio = 0.14;
        const defaultCenterX = containerWidth * defaultCenterXRatio;
        const defaultCenterY = containerHeight * defaultCenterYRatio;
        card.dataset.defaultCenterXRatio = defaultCenterXRatio;
        card.dataset.defaultCenterYRatio = defaultCenterYRatio;
        card.dataset.visualLeftRatio = defaultCenterXRatio;
        card.dataset.visualTopRatio = defaultCenterYRatio;
        updateCardPosition(card);
    }
    function updateCardPosition(card) {
        const containerWidth = container.offsetWidth;
        const containerHeight = container.offsetHeight;
        const defaultCenterXRatio = parseFloat(card.dataset.defaultCenterXRatio);
        const defaultCenterYRatio = parseFloat(card.dataset.defaultCenterYRatio);
        const visualLeftRatio = parseFloat(card.dataset.visualLeftRatio);
        const visualTopRatio = parseFloat(card.dataset.visualTopRatio);
        const cardWidth = card.offsetWidth;
        const cardHeight = card.offsetHeight;
        const newX = visualLeftRatio * containerWidth - defaultCenterXRatio;
        const newY = visualTopRatio * containerHeight - defaultCenterYRatio;
        card.style.left = newX + 'px';
        card.style.top = newY + 'px';
    }
    let highestZIndex = 1;
	function makeDraggable(card) {
    let isMoving = false;
    let startX, startY, initialX, initialY;
    card.addEventListener('mousedown', (e) => {
        isMoving = true;
        startX = e.clientX;
        startY = e.clientY;
        initialX = card.offsetLeft;
        initialY = card.offsetTop;
        highestZIndex++;
        card.style.zIndex = highestZIndex;
        document.addEventListener('mousemove', moveCard);
        document.addEventListener('mouseup', stopMove);
    });
    function moveCard(e) {
        if (isMoving) {
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;
            const newX = initialX + dx;
            const newY = initialY + dy;
            const minY = 0;
            const maxX = container.offsetWidth - card.offsetWidth;
            const maxY = container.offsetHeight - card.offsetHeight;
            if (newX >= 0 && newX <= maxX && newY >= minY && newY <= maxY) {
                card.style.left = newX + 'px';
                card.style.top = newY + 'px';
                const visualLeftRatio = newX / container.offsetWidth;
                const visualTopRatio = newY / container.offsetHeight;
                card.dataset.visualLeftRatio = visualLeftRatio;
                card.dataset.visualTopRatio = visualTopRatio;
            }
        }
    }
    function stopMove() {
        isMoving = false;
        document.removeEventListener('mousemove', moveCard);
        document.removeEventListener('mouseup', stopMove);
    }
    card.addEventListener('dblclick', () => {
        let rotation = parseInt(card.style.transform.replace('rotate(', '').replace('deg)', '')) || 0;
        if (rotation % 360 === 0) {
            rotation -= 90;
        } else {
            rotation += 90;
        }
        rotation = (rotation - 360) % 360;
        card.style.transform = `rotate(${rotation}deg)`;
    });
    }
    function adjustCardSize() {
        const cards = document.querySelectorAll('.card');
        cards.forEach(card => {
            card.style.width = (window.innerWidth / 10) + 'px';
            updateCardPosition(card);
        });
    }
    function adjustContainerSize() {
        const backgroundImg = 'https://github.com/DracoFabz/DracoFabz.github.io/raw/main/Layout.png';
        const img = new Image();
        img.src = backgroundImg;
        img.onload = function() {
            const imgWidth = img.width;
            const imgHeight = img.height;
            container.style.width = `calc(100% - 10px)`;
            container.style.height = `calc((100vw / ${imgWidth}) * ${imgHeight})`;
            Array.from(container.getElementsByClassName('card')).forEach(updateCardPosition);
        };
    }
    function adjustButtonBanner() {
        const banner = document.getElementById('banner');
        const buttonsBanner = document.getElementById('buttons-banner');
        const bannerHeight = banner.offsetHeight;
        const buttons = document.querySelectorAll('.button');
        buttonsBanner.style.top = `${bannerHeight + 10}px`;
        buttonsBanner.style.height = `${bannerHeight}px`;
        buttons.forEach(button => {
            button.style.height = `${0.7 * bannerHeight}px`;
            button.style.lineHeight = `${0.7 * bannerHeight}px`;
            button.style.fontSize = `${0.35 * bannerHeight}px`;
        });
    }
    window.addEventListener('resize', () => {
        requestAnimationFrame(() => {
            adjustCardSize();
            adjustContainerSize();
            adjustButtonBanner();
        });
    });
    document.addEventListener('DOMContentLoaded', () => {
        adjustCardSize();
        adjustContainerSize();
        adjustButtonBanner();
    });
</script>
</body>
</html>